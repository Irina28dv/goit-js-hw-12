{"version":3,"file":"commonHelpers.js","sources":["../src/js/index.js"],"sourcesContent":["import axios from 'axios';\nimport iziToast from 'izitoast';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nconst form = document.querySelector('.form');\nconst galleryGrid = document.querySelector('.js-gallery-grid');\nconst loader = document.querySelector('.loader');\nconst loadMoreBtn = document.querySelector('.js-load-more-btn');\n\nlet gallery = new SimpleLightbox('.gallery-grid a', {\n  captionsData: 'alt',\n});\n\nform.addEventListener('submit', handleFormSubmit);\nloadMoreBtn.addEventListener('click', handleLoadBtnClick);\n\nlet page = 1;\nlet inputValue;\nlet totalPages = 0;\nlet loading = false;\n\nasync function handleFormSubmit(event) {\n  event.preventDefault();\n  showLoader();\n\n  galleryGrid.innerHTML = '';\n\n  inputValue = event.target.elements.query.value.trim();\n\n  if (!inputValue) {\n    hideLoader();\n    showErrorToast('Search field is empty');\n    return;\n  }\n\n  try {\n    page = 1;\n    const data = await getImagesByInputValue();\n    if (data?.hits?.length) {\n      hideLoader();\n      totalPages = Math.ceil(data.totalHits / 15);\n      checkLoadBtnStatus();\n      createMarkupByHits(data.hits);\n      showLoadMoreBtn();\n      updateScrollObserver();\n      smoothScroll();\n      return;\n    }\n    throw Error('Sorry, there are no images matching your search query. Please try again!');\n  } catch (error) {\n    hideLoader();\n    showErrorToast(typeof error === 'string' ? error : 'Something went wrong, sorry!');\n  }\n\n  form.reset();\n}\n\nasync function handleLoadBtnClick(event) {\n  if (loading) {\n    return;\n  }\n\n  loading = true;\n\n  showLoader();\n  hideLoadMoreBtn();\n\n  try {\n    page += 1;\n\n    const data = await getImagesByInputValue();\n    if (data?.hits?.length) {\n      hideLoader();\n      checkLoadBtnStatus();\n      createMarkupByHits(data.hits);\n    } else {\n      hideLoadMoreBtn();\n    }\n  } catch (error) {\n    hideLoader();\n    showErrorToast(typeof error === 'string' ? error : 'Something went wrong, sorry!');\n  } finally {\n    loading = false;\n  }\n\n  form.reset();\n}\n\nfunction checkLoadBtnStatus() {\n  if (totalPages !== page) {\n    showLoadMoreBtn();\n  } else {\n    hideLoadMoreBtn();\n    showInfoToast(\"We're sorry, but you've reached the end of search results.\");\n  }\n}\n\nfunction showLoader() {\n  loader.classList.remove('hidden');\n}\n\nfunction hideLoader() {\n  loader.classList.add('hidden');\n}\n\nfunction showLoadMoreBtn() {\n  loadMoreBtn.classList.remove('hidden');\n}\n\nfunction hideLoadMoreBtn() {\n  loadMoreBtn.classList.add('hidden');\n}\n\nasync function getImagesByInputValue() {\n  const response = await axios.get('https://pixabay.com/api/', {\n    params: {\n      key: '42317586-b983a1ee46e38e925d954d84d',\n      q: inputValue,\n      image_type: 'photo',\n      orientation: 'horizontal',\n      safeSearch: true,\n      page: page,\n      per_page: 15,\n    },\n  });\n  return response.data;\n}\n\nfunction createMarkupByHits(hits) {\n  const fragment = document.createDocumentFragment();\n  hits.forEach(({ webformatURL, largeImageURL, tags, likes, views, comments, downloads }) => {\n    const galleryItem = document.createElement('a');\n    galleryItem.href = largeImageURL;\n    galleryItem.classList.add('gallery-card');\n\n    const image = document.createElement('img');\n    image.src = webformatURL;\n    image.alt = tags;\n\n    const detailsBox = document.createElement('div');\n    detailsBox.classList.add('img-details-box');\n\n    const likesElement = createDetailItem('Likes', likes);\n    const viewsElement = createDetailItem('Views', views);\n    const commentsElement = createDetailItem('Comments', comments);\n    const downloadsElement = createDetailItem('Downloads', downloads);\n\n    detailsBox.append(likesElement, viewsElement, commentsElement, downloadsElement);\n    galleryItem.append(image, detailsBox);\n    fragment.appendChild(galleryItem);\n  });\n\n  galleryGrid.appendChild(fragment);\n  gallery.refresh();\n}\n\nfunction createDetailItem(label, value) {\n  const detailItem = document.createElement('p');\n  detailItem.classList.add('detail-item');\n  detailItem.innerHTML = `<b>${label}:</b> ${value}`;\n  return detailItem;\n}\n\nfunction updateScrollObserver() {\n  const observer = new IntersectionObserver(\n    (entries) => {\n      entries.forEach((entry) => {\n        if (entry.isIntersecting) {\n          handleLoadBtnClick();\n        }\n      });\n    },\n    {\n      rootMargin: '0px',\n      threshold: 0.2,\n    }\n  );\n\n  observer.observe(loadMoreBtn);\n}\n\nfunction smoothScroll() {\n  const cardHeight = document.querySelector('.gallery-card')?.getBoundingClientRect().height || 0;\n  window.scrollBy({\n    top: cardHeight * 2,\n    behavior: 'smooth',\n  });\n}\n\nfunction showErrorToast(message) {\n  iziToast.error({\n    message: message,\n    position: 'topRight',\n  });\n}\n\nfunction showInfoToast(message) {\n  iziToast.info({\n    message: message,\n    position: 'topRight',\n  });\n}\n"],"names":["form","galleryGrid","loader","loadMoreBtn","gallery","SimpleLightbox","handleFormSubmit","handleLoadBtnClick","page","inputValue","totalPages","loading","event","showLoader","hideLoader","showErrorToast","data","getImagesByInputValue","_a","checkLoadBtnStatus","createMarkupByHits","showLoadMoreBtn","updateScrollObserver","smoothScroll","error","hideLoadMoreBtn","showInfoToast","axios","hits","fragment","webformatURL","largeImageURL","tags","likes","views","comments","downloads","galleryItem","image","detailsBox","likesElement","createDetailItem","viewsElement","commentsElement","downloadsElement","label","value","detailItem","entries","entry","cardHeight","message","iziToast"],"mappings":"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"}